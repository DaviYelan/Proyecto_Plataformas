# Multi-stage build: compile with Maven, run with lightweight JRE
FROM maven:3.9.4-eclipse-temurin-17 AS build
WORKDIR /app
COPY pom.xml ./
COPY src ./src
RUN mvn -B -DskipTests package && \
	if [ -f target/buses-1.0-SNAPSHOT-shaded.jar ]; then \
		cp target/buses-1.0-SNAPSHOT-shaded.jar target/app.jar; \
	elif [ -f target/buses-1.0-SNAPSHOT.jar ]; then \
		cp target/buses-1.0-SNAPSHOT.jar target/app.jar; \
	else \
		echo "No jar produced"; exit 1; \
	fi

# Runtime image
FROM eclipse-temurin:17-jre-jammy
WORKDIR /app
# copy the shaded jar (or normal jar) generated by the build
## Copiar el JAR 'app.jar' generado en la etapa de build
COPY --from=build /app/target/app.jar /app/app.jar
EXPOSE 8099
ENTRYPOINT ["java","-jar","/app/app.jar"]
